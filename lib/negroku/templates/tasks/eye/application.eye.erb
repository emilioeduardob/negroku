require 'eye-http'

# Setups Eye global conf if not already
Eye.config do
  logger '/var/log/eye-global.log'
  http :enable => true, :host => "0.0.0.0", :port => 12345
end

# Adding application
Eye.application '<%= fetch(:application)%>' do

  # All options inherits down to the config leafs.
  # except `env`, which merging down

  stdall '<%= shared_path %>/log/eye.log'
  working_dir '<%= current_path %>'

  trigger :flapping, times: 10, within: 1.minute, retry_in: 10.minutes

  check :cpu, every: 10.seconds, below: 100, times: 3 # global check for all processes

<% processes.each do |process_name, options| -%>
<%= partial options[:template], binding %>
<% end -%>

end
